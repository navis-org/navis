<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Python library for analysis of neuroanatomical data."><link href="../nblast_funcs/" rel="prev"><link href="../synblast_funcs/" rel="next"><link rel="icon" href="../../../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>smat - navis</title><link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css"><link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css"><link rel="stylesheet" href="../../../../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel="stylesheet" href="../../../../assets/_markdown_exec_pyodide.css"><link rel="stylesheet" href="../../../../assets/_mkdocstrings.css"><link rel="stylesheet" href="../../../../stylesheets/extra.css"><link rel="stylesheet" href="../../../../assets/external/unpkg.com/katex@0/dist/katex.min.css"><link rel="stylesheet" href="../../../../sg_gallery-rendered-html.css"><link rel="stylesheet" href="../../../../sg_gallery-binder.css"><link rel="stylesheet" href="../../../../sg_gallery-dataframe.css"><link rel="stylesheet" href="../../../../sg_gallery.css"><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property="og:type" content="website"><meta property="og:title" content="smat - navis"><meta property="og:description" content="Python library for analysis of neuroanatomical data."><meta property="og:image" content="./assets/images/social/reference/navis/nbl/smat.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:url" content="None"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="smat - navis"><meta name="twitter:description" content="Python library for analysis of neuroanatomical data."><meta name="twitter:image" content="./assets/images/social/reference/navis/nbl/smat.png"><link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#navis.nbl.smat.Digitizer" class="md-skip"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="Header"> <a href="../../../.." title="navis" class="md-header__button md-logo" aria-label="navis" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> navis </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> smat </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M296.5 291.1C321 265.2 336 230.4 336 192c0-79.5-64.5-144-144-144S48 112.5 48 192c0 38.4 15 73.2 39.5 99.1 21.3 22.4 44.9 54 53.3 92.9h102.4c8.4-39 32-70.5 53.3-92.9m34.8 33C307.7 349 288 379.4 288 413.7V432c0 44.2-35.8 80-80 80h-32c-44.2 0-80-35.8-80-80v-18.3c0-34.3-19.7-64.7-43.3-89.6C20 289.7 0 243.2 0 192 0 86 86 0 192 0s192 86 192 192c0 51.2-20 97.7-52.7 132.1M144 184c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-48.6 39.4-88 88-88 13.3 0 24 10.7 24 24s-10.7 24-24 24c-22.1 0-40 17.9-40 40"></path></svg> </label> <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="pink" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M292.9 384c7.3-22.3 21.9-42.5 38.4-59.9C364 289.7 384 243.2 384 192 384 86 298 0 192 0S0 86 0 192c0 51.2 20 97.7 52.7 132.1 16.5 17.4 31.2 37.6 38.4 59.9h201.7zm-4.9 48H96v16c0 44.2 35.8 80 80 80h32c44.2 0 80-35.8 80-80zM184 112c-39.8 0-72 32.2-72 72 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3 53.7-120 120-120 13.3 0 24 10.7 24 24s-10.7 24-24 24"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required> <label class="md-search__icon md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class="md-search__options" aria-label="Search"> <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a href="https://github.com/navis-org/navis" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> navis-org/navis </div> </a> </div> </nav> <nav class="md-tabs" aria-label="Tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a href="../../../.." class="md-tabs__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg> Home </a> </li> <li class="md-tabs__item"> <a href="../../../../installation/" class="md-tabs__link"> Installation </a> </li> <li class="md-tabs__item"> <a href="../../../../quickstart/" class="md-tabs__link"> Quickstart </a> </li> <li class="md-tabs__item"> <a href="../../../../generated/gallery/" class="md-tabs__link"> Tutorials </a> </li> <li class="md-tabs__item"> <a href="../../../../ecosystem/" class="md-tabs__link"> <span style="color:rgb(250,175,3)">NAVis</span> &amp; Friends </a> </li> <li class="md-tabs__item"> <a href="../../../../changelog/" class="md-tabs__link"> Changelog </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href="../../../../api/" class="md-tabs__link"> API Documentation </a> </li> </ul> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href="../../../.." title="navis" class="md-nav__button md-logo" aria-label="navis" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> navis </label> <div class="md-nav__source"> <a href="https://github.com/navis-org/navis" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> navis-org/navis </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../.." class="md-nav__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg> <span class="md-ellipsis"> Home </span> </a> </li> <li class="md-nav__item"> <a href="../../../../installation/" class="md-nav__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.71 20.29-1.42 1.42a1 1 0 0 1-1.41 0L7 9.85A3.8 3.8 0 0 1 6 10a4 4 0 0 1-3.78-5.3l2.54 2.54.53-.53 1.42-1.42.53-.53L4.7 2.22A4 4 0 0 1 10 6a3.8 3.8 0 0 1-.15 1l11.86 11.88a1 1 0 0 1 0 1.41M2.29 18.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0l5.47-5.46-2.83-2.83M20 2l-4 2v2l-2.17 2.17 2 2L18 8h2l2-4Z"></path></svg> <span class="md-ellipsis"> Installation </span> </a> </li> <li class="md-nav__item"> <a href="../../../../quickstart/" class="md-nav__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m13.13 22.19-1.63-3.83c1.57-.58 3.04-1.36 4.4-2.27zM5.64 12.5l-3.83-1.63 6.1-2.77C7 9.46 6.22 10.93 5.64 12.5M21.61 2.39S16.66.269 11 5.93c-2.19 2.19-3.5 4.6-4.35 6.71-.28.75-.09 1.57.46 2.13l2.13 2.12c.55.56 1.37.74 2.12.46A19.1 19.1 0 0 0 18.07 13c5.66-5.66 3.54-10.61 3.54-10.61m-7.07 7.07c-.78-.78-.78-2.05 0-2.83s2.05-.78 2.83 0c.77.78.78 2.05 0 2.83s-2.05.78-2.83 0m-5.66 7.07-1.41-1.41zM6.24 22l3.64-3.64c-.34-.09-.67-.24-.97-.45L4.83 22zM2 22h1.41l4.77-4.76-1.42-1.41L2 20.59zm0-2.83 4.09-4.08c-.21-.3-.36-.62-.45-.97L2 17.76z"></path></svg> <span class="md-ellipsis"> Quickstart </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4"> <div class="md-nav__link md-nav__container"> <a href="../../../../generated/gallery/" class="md-nav__link "> <span class="md-ellipsis"> Tutorials </span> </a> <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2"> <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0"> <span class="md-ellipsis"> General Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_2"> <span class="md-nav__icon md-icon"></span> General Tutorials </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/tutorial_basic_00_basics/" class="md-nav__link"> <span class="md-ellipsis"> The Basics </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/tutorial_basic_01_neurons/" class="md-nav__link"> <span class="md-ellipsis"> Neuron Types </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/tutorial_basic_02_neuronlists/" class="md-nav__link"> <span class="md-ellipsis"> Lists of Neurons </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3"> <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0"> <span class="md-ellipsis"> Import / Export </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_3"> <span class="md-nav__icon md-icon"></span> Import / Export </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/0_io/tutorial_io_00_skeletons/" class="md-nav__link"> <span class="md-ellipsis"> Skeletons </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/0_io/tutorial_io_01_meshes/" class="md-nav__link"> <span class="md-ellipsis"> Meshes </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/0_io/tutorial_io_02_dotprops/" class="md-nav__link"> <span class="md-ellipsis"> Dotprops </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/0_io/tutorial_io_04_pickle/" class="md-nav__link"> <span class="md-ellipsis"> Pickling </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/0_io/zzz_tutorial_io_05_skeletonize/" class="md-nav__link"> <span class="md-ellipsis"> Skeletons from light-level data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4"> <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0"> <span class="md-ellipsis"> Plotting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_4"> <span class="md-nav__icon md-icon"></span> Plotting </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_00_intro/" class="md-nav__link"> <span class="md-ellipsis"> Plotting Overview </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_01_colors/" class="md-nav__link"> <span class="md-ellipsis"> Coloring </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_02_1d/" class="md-nav__link"> <span class="md-ellipsis"> Neuron "Barcodes" </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_03_dend/" class="md-nav__link"> <span class="md-ellipsis"> Neuron Topology </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_04_skeletons/" class="md-nav__link"> <span class="md-ellipsis"> Fine-tuning Skeletons </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_05_depth/" class="md-nav__link"> <span class="md-ellipsis"> Depth-coloring </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_06_cortex/" class="md-nav__link"> <span class="md-ellipsis"> Cortical Neurons </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/1_plotting/tutorial_plotting_07_xkcd/" class="md-nav__link"> <span class="md-ellipsis"> XKCD Style </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5"> <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0"> <span class="md-ellipsis"> Morphology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_5"> <span class="md-nav__icon md-icon"></span> Morphology </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/2_morpho/tutorial_morpho_00_manipulate/" class="md-nav__link"> <span class="md-ellipsis"> Manipulate Morphology </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/2_morpho/tutorial_morpho_01_analyze/" class="md-nav__link"> <span class="md-ellipsis"> Analyzing Neuron Morphology </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6"> <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0"> <span class="md-ellipsis"> Interfaces </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_6"> <span class="md-nav__icon md-icon"></span> Interfaces </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/3_interfaces/tutorial_interfaces_00_neuron/" class="md-nav__link"> <span class="md-ellipsis"> NEURON simulator </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/3_interfaces/tutorial_interfaces_01_neuron2/" class="md-nav__link"> <span class="md-ellipsis"> Visualize NEURON model </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/3_interfaces/tutorial_interfaces_02_blender/" class="md-nav__link"> <span class="md-ellipsis"> Blender 3D </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7"> <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0"> <span class="md-ellipsis"> Remote Data Sources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_7"> <span class="md-nav__icon md-icon"></span> Remote Data Sources </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/4_remote/tutorial_remote_00_neuprint/" class="md-nav__link"> <span class="md-ellipsis"> neuPrint </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/4_remote/tutorial_remote_01_cloudvolume/" class="md-nav__link"> <span class="md-ellipsis"> Neuroglancer &amp; CloudVolume </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/4_remote/tutorial_remote_02_microns/" class="md-nav__link"> <span class="md-ellipsis"> The MICrONS Datasets </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/4_remote/tutorial_remote_03_insect_db/" class="md-nav__link"> <span class="md-ellipsis"> Insect Brain DB </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/4_remote/tutorial_remote_04_h01/" class="md-nav__link"> <span class="md-ellipsis"> H01 Dataset </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8"> <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0"> <span class="md-ellipsis"> NBLAST </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_8"> <span class="md-nav__icon md-icon"></span> NBLAST </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/5_nblast/tutorial_nblast_00_intro/" class="md-nav__link"> <span class="md-ellipsis"> NBLAST </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/5_nblast/tutorial_nblast_03_smat/" class="md-nav__link"> <span class="md-ellipsis"> Custom score matrices </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/5_nblast/zzz_tutorial_nblast_01_flycircuit/" class="md-nav__link"> <span class="md-ellipsis"> NBLAST against FlyCircuit </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/5_nblast/zzz_tutorial_nblast_02_hemibrain/" class="md-nav__link"> <span class="md-ellipsis"> NBLAST using light-level data </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9"> <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0"> <span class="md-ellipsis"> Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4_9"> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../../../generated/gallery/6_misc/tutorial_misc_00_multiprocess/" class="md-nav__link"> <span class="md-ellipsis"> Multiprocessing </span> </a> </li> <li class="md-nav__item"> <a href="../../../../generated/gallery/6_misc/tutorial_misc_01_transforms/" class="md-nav__link"> <span class="md-ellipsis"> Transformations </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="../../../../ecosystem/" class="md-nav__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"></path></svg> <span class="md-ellipsis"> <span style="color:rgb(250,175,3)">NAVis</span> &amp; Friends </span> </a> </li> <li class="md-nav__item"> <a href="../../../../changelog/" class="md-nav__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.803.179Q8.76.171 7.72.38C5.639.797 3.974 1.828 2.77 3.445 1.232 5.515.367 8.072.049 11.492c-.125 1.353.008 2.711.181 4.216a9.97 9.97 0 0 0 2.144 5.214c.933 1.157 2.004 1.917 3.272 2.324a12 12 0 0 0 3.336.574 6 6 0 0 0 .795-.034l.416-.041a93 93 0 0 0 1.721-.186 21.4 21.4 0 0 0 7.393-2.257c2.007-1.048 3.41-2.594 4.17-4.597.354-.93.523-1.713.523-2.445a4.6 4.6 0 0 0-.064-.762c-.405-2.379-1.235-4.428-2.555-6.264-1.634-2.276-3.288-3.878-5.202-5.045C13.993.86 11.89.193 9.803.18Zm-.439 1.064q1.154-.032 2.376.237h-.001c2.73.597 5.137 2.002 7.154 4.173 2.288 2.46 3.591 5.045 3.988 7.899.071.528-.013 1.114-.096 1.622-.388 2.327-1.663 4.063-3.786 5.16a21 21 0 0 1-7.166 2.182c-.558.066-1.12.123-1.757.187l-.088.01a6.8 6.8 0 0 1-1.658-.03c-.69-.098-1.472-.21-2.224-.389-1.767-.42-3.069-1.622-3.978-3.658-.684-1.538-1.038-3.245-1.081-5.233a17.9 17.9 0 0 1 1.149-6.798c.62-1.641 1.517-3.453 3.462-4.418a8.75 8.75 0 0 1 3.706-.944m1.108 1.47a7.8 7.8 0 0 0-2.24.41c-1.6.525-2.718 1.304-3.523 2.438-1.499 2.118-2.275 4.58-2.31 7.325a10.1 10.1 0 0 0 .803 4.388c1.081 2.569 3.053 4.064 5.707 4.326 2.796.27 5.543-.381 8.178-1.937a8.1 8.1 0 0 0 2.772-2.624 7.1 7.1 0 0 0 1.168-3.86c0-2.162-1.015-4.47-3.049-6.862a6.4 6.4 0 0 0-.704-.707c-2.333-2.006-4.567-2.966-6.802-2.898zm.099 1.035c1.492-.022 3.015.475 4.672 1.508 1.783 1.117 3.161 2.763 4.091 4.909.887 2.02.905 3.938.058 5.696a6.8 6.8 0 0 1-2.907 2.988c-2.253 1.232-4.315 1.776-6.458 1.713h-.022c-1.55.06-2.89-.32-4.098-1.163-.7-.488-1.241-1.202-1.655-2.183a10.9 10.9 0 0 1-.872-4.273A12.7 12.7 0 0 1 4.404 8.09a12 12 0 0 1 .874-1.622l.163-.27c.67-1.108 1.725-1.639 3.103-2.099a6.8 6.8 0 0 1 2.027-.35zm.03 1.62c-1.18.037-2.28.465-3.289 1.283-1.395 1.13-2.23 2.72-2.63 4.993a7.24 7.24 0 0 0 .676 4.613c1.062 2.054 2.8 3.11 5.026 3.05h.008c2.958-.155 5.11-1.249 6.573-3.347a5.6 5.6 0 0 0 1.06-3.245 5.8 5.8 0 0 0-.242-1.639c-.72-2.435-2.161-4.145-4.29-5.085q-1.514-.667-2.892-.624Zm.312 1.064c.77.008 1.547.191 2.35.55 1.862.833 3.073 2.332 3.598 4.462.526 2.13-.27 4.205-2.066 5.423-1.479.999-2.93 1.447-4.438 1.367h-.04c-1.004.08-1.994-.226-2.943-.91a3.67 3.67 0 0 1-1.29-1.72 7.6 7.6 0 0 1-.514-2.727 8.5 8.5 0 0 1 .747-3.38c.676-1.556 1.724-2.503 3.215-2.893q.69-.18 1.38-.172zM9.455 8.758v6.882h1.155v-1.908l1.68 1.908h1.462l-2.273-2.5 1.871-1.958h-1.509l-1.231 1.337V8.758Z"></path></svg> <span class="md-ellipsis"> Changelog </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked> <div class="md-nav__link md-nav__container"> <a href="../../../../api/" class="md-nav__link "> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10"></path></svg> <span class="md-ellipsis"> API Documentation </span> </a> <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_7"> <span class="md-nav__icon md-icon"></span> API Documentation </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" checked> <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0"> <span class="md-ellipsis"> Code References </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_7_1"> <span class="md-nav__icon md-icon"></span> Code References </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1" checked> <div class="md-nav__link md-nav__container"> <a href="../../" class="md-nav__link "> <span class="md-ellipsis"> navis </span> </a> <label class="md-nav__link " for="__nav_7_1_1" id="__nav_7_1_1_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_1_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_7_1_1"> <span class="md-nav__icon md-icon"></span> navis </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../config/" class="md-nav__link"> <span class="md-ellipsis"> config </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_2"> <div class="md-nav__link md-nav__container"> <a href="../../connectivity/" class="md-nav__link "> <span class="md-ellipsis"> connectivity </span> </a> <label class="md-nav__link " for="__nav_7_1_1_2" id="__nav_7_1_1_2_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_2_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_2"> <span class="md-nav__icon md-icon"></span> connectivity </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../connectivity/adjacency/" class="md-nav__link"> <span class="md-ellipsis"> adjacency </span> </a> </li> <li class="md-nav__item"> <a href="../../connectivity/similarity/" class="md-nav__link"> <span class="md-ellipsis"> similarity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_3"> <div class="md-nav__link md-nav__container"> <a href="../../conversion/" class="md-nav__link "> <span class="md-ellipsis"> conversion </span> </a> <label class="md-nav__link " for="__nav_7_1_1_3" id="__nav_7_1_1_3_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_3"> <span class="md-nav__icon md-icon"></span> conversion </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../conversion/meshing/" class="md-nav__link"> <span class="md-ellipsis"> meshing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_4"> <div class="md-nav__link md-nav__container"> <a href="../../core/" class="md-nav__link "> <span class="md-ellipsis"> core </span> </a> <label class="md-nav__link " for="__nav_7_1_1_4" id="__nav_7_1_1_4_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_4"> <span class="md-nav__icon md-icon"></span> core </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../core/base/" class="md-nav__link"> <span class="md-ellipsis"> base </span> </a> </li> <li class="md-nav__item"> <a href="../../core/core_utils/" class="md-nav__link"> <span class="md-ellipsis"> core_utils </span> </a> </li> <li class="md-nav__item"> <a href="../../core/skeleton/" class="md-nav__link"> <span class="md-ellipsis"> skeleton </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_5"> <div class="md-nav__link md-nav__container"> <a href="../../graph/" class="md-nav__link "> <span class="md-ellipsis"> graph </span> </a> <label class="md-nav__link " for="__nav_7_1_1_5" id="__nav_7_1_1_5_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_5"> <span class="md-nav__icon md-icon"></span> graph </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../graph/graph_utils/" class="md-nav__link"> <span class="md-ellipsis"> graph_utils </span> </a> </li> <li class="md-nav__item"> <a href="../../graph/clinic/" class="md-nav__link"> <span class="md-ellipsis"> clinic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_6"> <div class="md-nav__link md-nav__container"> <a href="../../meshes/" class="md-nav__link "> <span class="md-ellipsis"> meshes </span> </a> <label class="md-nav__link " for="__nav_7_1_1_6" id="__nav_7_1_1_6_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_6"> <span class="md-nav__icon md-icon"></span> meshes </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../meshes/b3d/" class="md-nav__link"> <span class="md-ellipsis"> b3d </span> </a> </li> <li class="md-nav__item"> <a href="../../meshes/mesh_utils/" class="md-nav__link"> <span class="md-ellipsis"> mesh_utils </span> </a> </li> <li class="md-nav__item"> <a href="../../meshes/o3d/" class="md-nav__link"> <span class="md-ellipsis"> o3d </span> </a> </li> <li class="md-nav__item"> <a href="../../meshes/operations/" class="md-nav__link"> <span class="md-ellipsis"> operations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_7"> <div class="md-nav__link md-nav__container"> <a href="../../models/" class="md-nav__link "> <span class="md-ellipsis"> models </span> </a> <label class="md-nav__link " for="__nav_7_1_1_7" id="__nav_7_1_1_7_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_7"> <span class="md-nav__icon md-icon"></span> models </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../models/network_models/" class="md-nav__link"> <span class="md-ellipsis"> network_models </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_8"> <div class="md-nav__link md-nav__container"> <a href="../../morpho/" class="md-nav__link "> <span class="md-ellipsis"> morpho </span> </a> <label class="md-nav__link " for="__nav_7_1_1_8" id="__nav_7_1_1_8_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_8"> <span class="md-nav__icon md-icon"></span> morpho </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../morpho/ivscc/" class="md-nav__link"> <span class="md-ellipsis"> ivscc </span> </a> </li> <li class="md-nav__item"> <a href="../../morpho/mmetrics/" class="md-nav__link"> <span class="md-ellipsis"> mmetrics </span> </a> </li> <li class="md-nav__item"> <a href="../../morpho/persistence/" class="md-nav__link"> <span class="md-ellipsis"> persistence </span> </a> </li> <li class="md-nav__item"> <a href="../../morpho/subset/" class="md-nav__link"> <span class="md-ellipsis"> subset </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_9" checked> <div class="md-nav__link md-nav__container"> <a href="../" class="md-nav__link "> <span class="md-ellipsis"> nbl </span> </a> <label class="md-nav__link " for="__nav_7_1_1_9" id="__nav_7_1_1_9_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_9_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_7_1_1_9"> <span class="md-nav__icon md-icon"></span> nbl </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../ablast_funcs/" class="md-nav__link"> <span class="md-ellipsis"> ablast_funcs </span> </a> </li> <li class="md-nav__item"> <a href="../nblast_funcs/" class="md-nav__link"> <span class="md-ellipsis"> nblast_funcs </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc"> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> smat </span> <span class="md-nav__icon md-icon"></span> </label> <a href="./" class="md-nav__link md-nav__link--active"> <span class="md-ellipsis"> smat </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer" class="md-nav__link"> <span class="md-ellipsis"> Digitizer </span> </a> <nav class="md-nav" aria-label="Digitizer"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_data" class="md-nav__link"> <span class="md-ellipsis"> from_data </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_geom" class="md-nav__link"> <span class="md-ellipsis"> from_geom </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_linear" class="md-nav__link"> <span class="md-ellipsis"> from_linear </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_strings" class="md-nav__link"> <span class="md-ellipsis"> from_strings </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.to_strings" class="md-nav__link"> <span class="md-ellipsis"> to_strings </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupAxis" class="md-nav__link"> <span class="md-ellipsis"> LookupAxis </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupDistDotBuilder" class="md-nav__link"> <span class="md-ellipsis"> LookupDistDotBuilder </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNd" class="md-nav__link"> <span class="md-ellipsis"> LookupNd </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder" class="md-nav__link"> <span class="md-ellipsis"> LookupNdBuilder </span> </a> <nav class="md-nav" aria-label="LookupNdBuilder"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.nonmatching" class="md-nav__link"> <span class="md-ellipsis"> nonmatching </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.build" class="md-nav__link"> <span class="md-ellipsis"> build </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.with_bin_counts" class="md-nav__link"> <span class="md-ellipsis"> with_bin_counts </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.with_digitizers" class="md-nav__link"> <span class="md-ellipsis"> with_digitizers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.SimpleLookup" class="md-nav__link"> <span class="md-ellipsis"> SimpleLookup </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.check_score_fn" class="md-nav__link"> <span class="md-ellipsis"> check_score_fn </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.chunksize" class="md-nav__link"> <span class="md-ellipsis"> chunksize </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.concat_results" class="md-nav__link"> <span class="md-ellipsis"> concat_results </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.dist_dot" class="md-nav__link"> <span class="md-ellipsis"> dist_dot </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.dist_dot_alpha" class="md-nav__link"> <span class="md-ellipsis"> dist_dot_alpha </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.is_monotonically_increasing" class="md-nav__link"> <span class="md-ellipsis"> is_monotonically_increasing </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.parse_boundary" class="md-nav__link"> <span class="md-ellipsis"> parse_boundary </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.parse_score_fn" class="md-nav__link"> <span class="md-ellipsis"> parse_score_fn </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.yield_not_same" class="md-nav__link"> <span class="md-ellipsis"> yield_not_same </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="../synblast_funcs/" class="md-nav__link"> <span class="md-ellipsis"> synblast_funcs </span> </a> </li> <li class="md-nav__item"> <a href="../utils/" class="md-nav__link"> <span class="md-ellipsis"> utils </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_10"> <div class="md-nav__link md-nav__container"> <a href="../../plotting/" class="md-nav__link "> <span class="md-ellipsis"> plotting </span> </a> <label class="md-nav__link " for="__nav_7_1_1_10" id="__nav_7_1_1_10_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_10_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_10"> <span class="md-nav__icon md-icon"></span> plotting </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../plotting/colors/" class="md-nav__link"> <span class="md-ellipsis"> colors </span> </a> </li> <li class="md-nav__item"> <a href="../../plotting/dd/" class="md-nav__link"> <span class="md-ellipsis"> dd </span> </a> </li> <li class="md-nav__item"> <a href="../../plotting/ddd/" class="md-nav__link"> <span class="md-ellipsis"> ddd </span> </a> </li> <li class="md-nav__item"> <a href="../../plotting/plot_utils/" class="md-nav__link"> <span class="md-ellipsis"> plot_utils </span> </a> </li> <li class="md-nav__item"> <a href="../../plotting/settings/" class="md-nav__link"> <span class="md-ellipsis"> settings </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_10_6"> <label class="md-nav__link" for="__nav_7_1_1_10_6" id="__nav_7_1_1_10_6_label" tabindex="0"> <span class="md-ellipsis"> vispy </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_1_1_10_6_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_10_6"> <span class="md-nav__icon md-icon"></span> vispy </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../plotting/vispy/viewer/" class="md-nav__link"> <span class="md-ellipsis"> viewer </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_10_7"> <label class="md-nav__link" for="__nav_7_1_1_10_7" id="__nav_7_1_1_10_7_label" tabindex="0"> <span class="md-ellipsis"> k3d </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_1_1_10_7_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_10_7"> <span class="md-nav__icon md-icon"></span> k3d </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../plotting/k3d/k3d_objects/" class="md-nav__link"> <span class="md-ellipsis"> k3d_objects </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_10_8"> <label class="md-nav__link" for="__nav_7_1_1_10_8" id="__nav_7_1_1_10_8_label" tabindex="0"> <span class="md-ellipsis"> plotly </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_1_1_10_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_10_8"> <span class="md-nav__icon md-icon"></span> plotly </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../plotting/plotly/graph_objs/" class="md-nav__link"> <span class="md-ellipsis"> graph_objs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_11"> <div class="md-nav__link md-nav__container"> <a href="../../transforms/" class="md-nav__link "> <span class="md-ellipsis"> transforms </span> </a> <label class="md-nav__link " for="__nav_7_1_1_11" id="__nav_7_1_1_11_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_11_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_11"> <span class="md-nav__icon md-icon"></span> transforms </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../transforms/align/" class="md-nav__link"> <span class="md-ellipsis"> align </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/affine/" class="md-nav__link"> <span class="md-ellipsis"> affine </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/base/" class="md-nav__link"> <span class="md-ellipsis"> base </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/cmtk/" class="md-nav__link"> <span class="md-ellipsis"> cmtk </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/elastix/" class="md-nav__link"> <span class="md-ellipsis"> elastix </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/factory/" class="md-nav__link"> <span class="md-ellipsis"> factory </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/h5reg/" class="md-nav__link"> <span class="md-ellipsis"> h5reg </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/templates/" class="md-nav__link"> <span class="md-ellipsis"> templates </span> </a> </li> <li class="md-nav__item"> <a href="../../transforms/thinplate/" class="md-nav__link"> <span class="md-ellipsis"> thinplate </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_12"> <div class="md-nav__link md-nav__container"> <a href="../../utils/" class="md-nav__link "> <span class="md-ellipsis"> utils </span> </a> <label class="md-nav__link " for="__nav_7_1_1_12" id="__nav_7_1_1_12_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_12_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_12"> <span class="md-nav__icon md-icon"></span> utils </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../utils/cv/" class="md-nav__link"> <span class="md-ellipsis"> cv </span> </a> </li> <li class="md-nav__item"> <a href="../../utils/decorators/" class="md-nav__link"> <span class="md-ellipsis"> decorators </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_13"> <label class="md-nav__link" for="__nav_7_1_1_13" id="__nav_7_1_1_13_label" tabindex="0"> <span class="md-ellipsis"> intersection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_13_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_13"> <span class="md-nav__icon md-icon"></span> intersection </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../intersection/intersect/" class="md-nav__link"> <span class="md-ellipsis"> intersect </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_14"> <label class="md-nav__link" for="__nav_7_1_1_14" id="__nav_7_1_1_14_label" tabindex="0"> <span class="md-ellipsis"> interfaces </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_14_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_14"> <span class="md-nav__icon md-icon"></span> interfaces </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../interfaces/blender/" class="md-nav__link"> <span class="md-ellipsis"> blender </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/cave_utils/" class="md-nav__link"> <span class="md-ellipsis"> cave_utils </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/h01/" class="md-nav__link"> <span class="md-ellipsis"> h01 </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/insectbrain_db/" class="md-nav__link"> <span class="md-ellipsis"> insectbrain_db </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/microns/" class="md-nav__link"> <span class="md-ellipsis"> microns </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/neuprint/" class="md-nav__link"> <span class="md-ellipsis"> neuprint </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/neuromorpho/" class="md-nav__link"> <span class="md-ellipsis"> neuromorpho </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_14_8"> <div class="md-nav__link md-nav__container"> <a href="../../interfaces/neuron/" class="md-nav__link "> <span class="md-ellipsis"> neuron </span> </a> <label class="md-nav__link " for="__nav_7_1_1_14_8" id="__nav_7_1_1_14_8_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_1_1_14_8_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_14_8"> <span class="md-nav__icon md-icon"></span> neuron </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../interfaces/neuron/comp/" class="md-nav__link"> <span class="md-ellipsis"> comp </span> </a> </li> <li class="md-nav__item"> <a href="../../interfaces/neuron/network/" class="md-nav__link"> <span class="md-ellipsis"> network </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_15"> <label class="md-nav__link" for="__nav_7_1_1_15" id="__nav_7_1_1_15_label" tabindex="0"> <span class="md-ellipsis"> io </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_15_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_15"> <span class="md-nav__icon md-icon"></span> io </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../io/base/" class="md-nav__link"> <span class="md-ellipsis"> base </span> </a> </li> <li class="md-nav__item"> <a href="../../io/hdf_io/" class="md-nav__link"> <span class="md-ellipsis"> hdf_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/mesh_io/" class="md-nav__link"> <span class="md-ellipsis"> mesh_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/nmx_io/" class="md-nav__link"> <span class="md-ellipsis"> nmx_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/nrrd_io/" class="md-nav__link"> <span class="md-ellipsis"> nrrd_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/precomputed_io/" class="md-nav__link"> <span class="md-ellipsis"> precomputed_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/rda_io/" class="md-nav__link"> <span class="md-ellipsis"> rda_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/swc_io/" class="md-nav__link"> <span class="md-ellipsis"> swc_io </span> </a> </li> <li class="md-nav__item"> <a href="../../io/tiff_io/" class="md-nav__link"> <span class="md-ellipsis"> tiff_io </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_1_16"> <label class="md-nav__link" for="__nav_7_1_1_16" id="__nav_7_1_1_16_label" tabindex="0"> <span class="md-ellipsis"> sampling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_1_16_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_7_1_1_16"> <span class="md-nav__icon md-icon"></span> sampling </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../../sampling/downsampling/" class="md-nav__link"> <span class="md-ellipsis"> downsampling </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer" class="md-nav__link"> <span class="md-ellipsis"> Digitizer </span> </a> <nav class="md-nav" aria-label="Digitizer"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_data" class="md-nav__link"> <span class="md-ellipsis"> from_data </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_geom" class="md-nav__link"> <span class="md-ellipsis"> from_geom </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_linear" class="md-nav__link"> <span class="md-ellipsis"> from_linear </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.from_strings" class="md-nav__link"> <span class="md-ellipsis"> from_strings </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.Digitizer.to_strings" class="md-nav__link"> <span class="md-ellipsis"> to_strings </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupAxis" class="md-nav__link"> <span class="md-ellipsis"> LookupAxis </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupDistDotBuilder" class="md-nav__link"> <span class="md-ellipsis"> LookupDistDotBuilder </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNd" class="md-nav__link"> <span class="md-ellipsis"> LookupNd </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder" class="md-nav__link"> <span class="md-ellipsis"> LookupNdBuilder </span> </a> <nav class="md-nav" aria-label="LookupNdBuilder"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.nonmatching" class="md-nav__link"> <span class="md-ellipsis"> nonmatching </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.build" class="md-nav__link"> <span class="md-ellipsis"> build </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.with_bin_counts" class="md-nav__link"> <span class="md-ellipsis"> with_bin_counts </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.LookupNdBuilder.with_digitizers" class="md-nav__link"> <span class="md-ellipsis"> with_digitizers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.SimpleLookup" class="md-nav__link"> <span class="md-ellipsis"> SimpleLookup </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.check_score_fn" class="md-nav__link"> <span class="md-ellipsis"> check_score_fn </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.chunksize" class="md-nav__link"> <span class="md-ellipsis"> chunksize </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.concat_results" class="md-nav__link"> <span class="md-ellipsis"> concat_results </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.dist_dot" class="md-nav__link"> <span class="md-ellipsis"> dist_dot </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.dist_dot_alpha" class="md-nav__link"> <span class="md-ellipsis"> dist_dot_alpha </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.is_monotonically_increasing" class="md-nav__link"> <span class="md-ellipsis"> is_monotonically_increasing </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.parse_boundary" class="md-nav__link"> <span class="md-ellipsis"> parse_boundary </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.parse_score_fn" class="md-nav__link"> <span class="md-ellipsis"> parse_score_fn </span> </a> </li> <li class="md-nav__item"> <a href="#navis.nbl.smat.yield_not_same" class="md-nav__link"> <span class="md-ellipsis"> yield_not_same </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1>smat</h1> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.Digitizer" class="doc doc-heading"> <code>navis.nbl.smat.Digitizer</code> <a href="#navis.nbl.smat.Digitizer" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Class converting continuous values into discrete indices.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>boundaries</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>N boundaries specifying N-1 bins. Must be monotonically increasing.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>clip</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Whether to set the bottom and top boundaries to -infinity and infinity respectively, effectively clipping incoming values: by default (True, True). False means "add a new bin for out-of-range values".</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a>]</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>(True, True)</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>right</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Whether bins should include their right (rather than left) boundary, by default False.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Digitizer</span><span class="p">(</span><span class="n">LookupAxis</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Class converting continuous values into discrete indices.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    boundaries : Sequence[float]</span>
<span class="sd">        N boundaries specifying N-1 bins.</span>
<span class="sd">        Must be monotonically increasing.</span>
<span class="sd">    clip : Tuple[bool, bool], optional</span>
<span class="sd">        Whether to set the bottom and top boundaries to -infinity and</span>
<span class="sd">        infinity respectively, effectively clipping incoming values: by</span>
<span class="sd">        default (True, True).</span>
<span class="sd">        False means "add a new bin for out-of-range values".</span>
<span class="sd">    right : bool, optional</span>
<span class="sd">        Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">        by default False.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">boundaries</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">clip</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>

        <span class="n">boundaries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="n">clip</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_min</span> <span class="o">=</span> <span class="n">boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">elif</span> <span class="n">boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">boundaries</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="n">clip</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="n">boundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">boundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">elif</span> <span class="n">boundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">boundaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_monotonically_increasing</span><span class="p">(</span><span class="n">boundaries</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Boundaries are not monotonically increasing: "</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">boundaries</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># searchsorted is marginally faster than digitize as it skips monotonicity checks</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">"left"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="k">else</span> <span class="s2">"right"</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Turn boundaries into list of labels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        round :     int, optional</span>
<span class="sd">                    Use to round bounds to the Nth decimal.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="s2">"("</span>
            <span class="n">rb</span> <span class="o">=</span> <span class="s2">"]"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="s2">"["</span>
            <span class="n">rb</span> <span class="o">=</span> <span class="s2">")"</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min</span>
        <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span>

        <span class="k">if</span> <span class="nb">round</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">lb</span><span class="si">}{</span><span class="n">lower</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">upper</span><span class="si">}{</span><span class="n">rb</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_strings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interval_strs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Set digitizer boundaries based on a sequence of interval expressions.</span>

<span class="sd">        e.g. `["(0, 1]", "(1, 5]", "(5, 10]"]`</span>

<span class="sd">        The lowermost and uppermost boundaries are converted to -infinity and</span>
<span class="sd">        infinity respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bound_strs : Sequence[str]</span>
<span class="sd">            Strings representing intervals, which must abut and have open/closed</span>
<span class="sd">            boundaries specified by brackets.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Digitizer</span>
<span class="sd">        """</span>
        <span class="n">bounds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">last_upper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">last_right</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">interval_strs</span><span class="p">:</span>
            <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">parse_boundary</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lower</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">last_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">right</span> <span class="o">!=</span> <span class="n">last_right</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Inconsistent half-open interval"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_right</span> <span class="o">=</span> <span class="n">right</span>

            <span class="k">if</span> <span class="n">last_upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lower</span> <span class="o">!=</span> <span class="n">last_upper</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Half-open intervals do not abut"</span><span class="p">)</span>

            <span class="n">last_upper</span> <span class="o">=</span> <span class="n">upper</span>

        <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">last_upper</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">last_right</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_linear</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Choose digitizer boundaries spaced linearly between two values.</span>

<span class="sd">        Input values will be clipped to fit within the given interval.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lower : float</span>
<span class="sd">            Lowest value</span>
<span class="sd">        upper : float</span>
<span class="sd">            Highest value</span>
<span class="sd">        nbins : int</span>
<span class="sd">            Number of bins</span>
<span class="sd">        right : bool, optional</span>
<span class="sd">            Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">            by default False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Digitizer</span>
<span class="sd">        """</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_geom</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">lowest_upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">highest_lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Choose digitizer boundaries in a geometric sequence.</span>

<span class="sd">        Additional bins will be added above and below the given values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lowest_upper : float</span>
<span class="sd">            Upper bound of the lowest bin. The lower bound of the lowest bin is</span>
<span class="sd">            often 0, which cannot be represented in a nontrivial geometric</span>
<span class="sd">            sequence.</span>
<span class="sd">        highest_lower : float</span>
<span class="sd">            Lower bound of the highest bin.</span>
<span class="sd">        nbins : int</span>
<span class="sd">            Number of bins</span>
<span class="sd">        right : bool, optional</span>
<span class="sd">            Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">            by default False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Digitizer</span>
<span class="sd">        """</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">lowest_upper</span><span class="p">,</span> <span class="n">highest_lower</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_data</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"quantile"</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Choose digitizer boundaries to evenly partition the given values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Sequence[float]</span>
<span class="sd">            Data which should be partitioned by the resulting digitizer.</span>
<span class="sd">        nbins : int</span>
<span class="sd">            Number of bins</span>
<span class="sd">        right : bool, optional</span>
<span class="sd">            Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">            by default False</span>
<span class="sd">        method : "quantile" | "linear" | "geometric"</span>
<span class="sd">            Method to use for partitioning the data space:</span>
<span class="sd">             - 'quantile' (default) will partition the data such that each bin</span>
<span class="sd">               contains the same number of data points. This is usually the</span>
<span class="sd">               method of choice because it is robust against outlier and because</span>
<span class="sd">               we are guaranteed to not have empty bin.</span>
<span class="sd">             - 'linear' will partition the data into evenly spaced bins.</span>
<span class="sd">             - 'geometric' will produce a log scale partition. This will not work</span>
<span class="sd">               if data has negative values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Digitizer</span>
<span class="sd">        """</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"quantile"</span><span class="p">,</span> <span class="s2">"linear"</span><span class="p">,</span> <span class="s2">"geometric"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"quantile"</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"linear"</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"geometric"</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Data must not have values &lt;= 0 for creating "</span>
                    <span class="s2">"geometric (logarithmic) bins."</span>
                <span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Digitizer</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">right</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">boundaries</span>
        <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.Digitizer.from_data" class="doc doc-heading"> <code class="highlight language-python"><span class="n">from_data</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href="#navis.nbl.smat.Digitizer.from_data" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Choose digitizer boundaries to evenly partition the given values.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>data</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Data which should be partitioned by the resulting digitizer.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>nbins</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Number of bins</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>right</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Whether bins should include their right (rather than left) boundary, by default False</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>method</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Method to use for partitioning the data space: - 'quantile' (default) will partition the data such that each bin contains the same number of data points. This is usually the method of choice because it is robust against outlier and because we are guaranteed to not have empty bin. - 'linear' will partition the data into evenly spaced bins. - 'geometric' will produce a log scale partition. This will not work if data has negative values.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>'quantile' | 'linear' | 'geometric'</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'quantile'</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" title="navis.nbl.smat.Digitizer" href="#navis.nbl.smat.Digitizer">Digitizer</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_data</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"quantile"</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Choose digitizer boundaries to evenly partition the given values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : Sequence[float]</span>
<span class="sd">        Data which should be partitioned by the resulting digitizer.</span>
<span class="sd">    nbins : int</span>
<span class="sd">        Number of bins</span>
<span class="sd">    right : bool, optional</span>
<span class="sd">        Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">        by default False</span>
<span class="sd">    method : "quantile" | "linear" | "geometric"</span>
<span class="sd">        Method to use for partitioning the data space:</span>
<span class="sd">         - 'quantile' (default) will partition the data such that each bin</span>
<span class="sd">           contains the same number of data points. This is usually the</span>
<span class="sd">           method of choice because it is robust against outlier and because</span>
<span class="sd">           we are guaranteed to not have empty bin.</span>
<span class="sd">         - 'linear' will partition the data into evenly spaced bins.</span>
<span class="sd">         - 'geometric' will produce a log scale partition. This will not work</span>
<span class="sd">           if data has negative values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Digitizer</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"quantile"</span><span class="p">,</span> <span class="s2">"linear"</span><span class="p">,</span> <span class="s2">"geometric"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"quantile"</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"linear"</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">"geometric"</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Data must not have values &lt;= 0 for creating "</span>
                <span class="s2">"geometric (logarithmic) bins."</span>
            <span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.Digitizer.from_geom" class="doc doc-heading"> <code class="highlight language-python"><span class="n">from_geom</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href="#navis.nbl.smat.Digitizer.from_geom" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Choose digitizer boundaries in a geometric sequence.</p> <p>Additional bins will be added above and below the given values.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>lowest_upper</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Upper bound of the lowest bin. The lower bound of the lowest bin is often 0, which cannot be represented in a nontrivial geometric sequence.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>highest_lower</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Lower bound of the highest bin.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>nbins</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Number of bins</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>right</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Whether bins should include their right (rather than left) boundary, by default False</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" title="navis.nbl.smat.Digitizer" href="#navis.nbl.smat.Digitizer">Digitizer</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_geom</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">lowest_upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">highest_lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Choose digitizer boundaries in a geometric sequence.</span>

<span class="sd">    Additional bins will be added above and below the given values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lowest_upper : float</span>
<span class="sd">        Upper bound of the lowest bin. The lower bound of the lowest bin is</span>
<span class="sd">        often 0, which cannot be represented in a nontrivial geometric</span>
<span class="sd">        sequence.</span>
<span class="sd">    highest_lower : float</span>
<span class="sd">        Lower bound of the highest bin.</span>
<span class="sd">    nbins : int</span>
<span class="sd">        Number of bins</span>
<span class="sd">    right : bool, optional</span>
<span class="sd">        Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">        by default False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Digitizer</span>
<span class="sd">    """</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">lowest_upper</span><span class="p">,</span> <span class="n">highest_lower</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.Digitizer.from_linear" class="doc doc-heading"> <code class="highlight language-python"><span class="n">from_linear</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href="#navis.nbl.smat.Digitizer.from_linear" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Choose digitizer boundaries spaced linearly between two values.</p> <p>Input values will be clipped to fit within the given interval.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>lower</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Lowest value</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>upper</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Highest value</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>nbins</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Number of bins</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>right</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Whether bins should include their right (rather than left) boundary, by default False</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" title="navis.nbl.smat.Digitizer" href="#navis.nbl.smat.Digitizer">Digitizer</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_linear</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Choose digitizer boundaries spaced linearly between two values.</span>

<span class="sd">    Input values will be clipped to fit within the given interval.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lower : float</span>
<span class="sd">        Lowest value</span>
<span class="sd">    upper : float</span>
<span class="sd">        Highest value</span>
<span class="sd">    nbins : int</span>
<span class="sd">        Number of bins</span>
<span class="sd">    right : bool, optional</span>
<span class="sd">        Whether bins should include their right (rather than left) boundary,</span>
<span class="sd">        by default False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Digitizer</span>
<span class="sd">    """</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.Digitizer.from_strings" class="doc doc-heading"> <code class="highlight language-python"><span class="n">from_strings</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href="#navis.nbl.smat.Digitizer.from_strings" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Set digitizer boundaries based on a sequence of interval expressions.</p> <p>e.g. <code>["(0, 1]", "(1, 5]", "(5, 10]"]</code></p> <p>The lowermost and uppermost boundaries are converted to -infinity and infinity respectively.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>bound_strs</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Strings representing intervals, which must abut and have open/closed boundaries specified by brackets.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" title="navis.nbl.smat.Digitizer" href="#navis.nbl.smat.Digitizer">Digitizer</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_strings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">interval_strs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Set digitizer boundaries based on a sequence of interval expressions.</span>

<span class="sd">    e.g. `["(0, 1]", "(1, 5]", "(5, 10]"]`</span>

<span class="sd">    The lowermost and uppermost boundaries are converted to -infinity and</span>
<span class="sd">    infinity respectively.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bound_strs : Sequence[str]</span>
<span class="sd">        Strings representing intervals, which must abut and have open/closed</span>
<span class="sd">        boundaries specified by brackets.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Digitizer</span>
<span class="sd">    """</span>
    <span class="n">bounds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_upper</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_right</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">interval_strs</span><span class="p">:</span>
        <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">parse_boundary</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lower</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">last_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">right</span> <span class="o">!=</span> <span class="n">last_right</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Inconsistent half-open interval"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_right</span> <span class="o">=</span> <span class="n">right</span>

        <span class="k">if</span> <span class="n">last_upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lower</span> <span class="o">!=</span> <span class="n">last_upper</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Half-open intervals do not abut"</span><span class="p">)</span>

        <span class="n">last_upper</span> <span class="o">=</span> <span class="n">upper</span>

    <span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">last_upper</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">last_right</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.Digitizer.to_strings" class="doc doc-heading"> <code class="highlight language-python"><span class="n">to_strings</span></code> <a href="#navis.nbl.smat.Digitizer.to_strings" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Turn boundaries into list of labels.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>round</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>    Use to round bounds to the Nth decimal.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> int</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Turn boundaries into list of labels.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    round :     int, optional</span>
<span class="sd">                Use to round bounds to the Nth decimal.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="s2">"("</span>
        <span class="n">rb</span> <span class="o">=</span> <span class="s2">"]"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="s2">"["</span>
        <span class="n">rb</span> <span class="o">=</span> <span class="s2">")"</span>

    <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min</span>
    <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span>

    <span class="k">if</span> <span class="nb">round</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">lb</span><span class="si">}{</span><span class="n">lower</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">upper</span><span class="si">}{</span><span class="n">rb</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.LookupAxis" class="doc doc-heading"> <code>navis.nbl.smat.LookupAxis</code> <a href="#navis.nbl.smat.LookupAxis" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Class converting some data into a linear index.</p> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LookupAxis</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Class converting some data into a linear index."""</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Number of bins represented by this instance."""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Convert some data into a linear index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : Union[T, Sequence[T]]</span>
<span class="sd">            Value to convert into an index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[int, Sequence[int]]</span>
<span class="sd">            If a scalar was given, return a scalar; otherwise, a numpy array of ints.</span>
<span class="sd">        """</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.LookupDistDotBuilder" class="doc doc-heading"> <code>navis.nbl.smat.LookupDistDotBuilder</code> <a href="#navis.nbl.smat.LookupDistDotBuilder" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Class for building a 2-dimensional score lookup for NBLAST.</p> <p>The scores are</p> <ol> <li>The distances between best-matching points</li> <li>The dot products of direction vectors around those points, optionally scaled by the colinearity <code>alpha</code>.</li> </ol> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>dotprops</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>            An indexable sequence of all neurons which will be
            used as the training set, as Dotprops objects.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> dict or list of Dotprops</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>matching_lists</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>            List of neurons, as indices into `dotprops`, which
            should be considered matches.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> list of lists of indices into dotprops</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>nonmatching_list</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>            List of neurons, as indices into `dotprops`,
            which should not be considered matches.
            If not given, all `dotprops` will be used
            (on the assumption that matches are a small subset
            of possible pairs).
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> list of indices into dotprops</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>use_alpha</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>            If true, multiply the dot product by the geometric
            mean of the matched points' alpha values
            (i.e. `sqrt(alpha1 * alpha2)`).
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> bool</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>False</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>draw_strat</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        Strategy for randomly drawing non-matching pairs.
        "batched" should be the right choice in most scenarios.
        "greedy" can be better if your pool of neurons is very
        small.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> "batched" | "greedy"</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'batched'</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>seed</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>            Non-matching pairs are drawn at random using this
            seed, by default {DEFAULT_SEED}.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> int</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><span title="navis.nbl.smat.DEFAULT_SEED">DEFAULT_SEED</span></code> </span> </p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LookupDistDotBuilder</span><span class="p">(</span><span class="n">LookupNdBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Class for building a 2-dimensional score lookup for NBLAST.</span>

<span class="sd">    The scores are</span>

<span class="sd">    1. The distances between best-matching points</span>
<span class="sd">    2. The dot products of direction vectors around those points,</span>
<span class="sd">        optionally scaled by the colinearity `alpha`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dotprops :          dict or list of Dotprops</span>
<span class="sd">                        An indexable sequence of all neurons which will be</span>
<span class="sd">                        used as the training set, as Dotprops objects.</span>
<span class="sd">    matching_lists :    list of lists of indices into dotprops</span>
<span class="sd">                        List of neurons, as indices into `dotprops`, which</span>
<span class="sd">                        should be considered matches.</span>
<span class="sd">    nonmatching_list :  list of indices into dotprops, optional</span>
<span class="sd">                        List of neurons, as indices into `dotprops`,</span>
<span class="sd">                        which should not be considered matches.</span>
<span class="sd">                        If not given, all `dotprops` will be used</span>
<span class="sd">                        (on the assumption that matches are a small subset</span>
<span class="sd">                        of possible pairs).</span>
<span class="sd">    use_alpha :         bool, optional</span>
<span class="sd">                        If true, multiply the dot product by the geometric</span>
<span class="sd">                        mean of the matched points' alpha values</span>
<span class="sd">                        (i.e. `sqrt(alpha1 * alpha2)`).</span>
<span class="sd">    draw_strat :    "batched" | "greedy"</span>
<span class="sd">                    Strategy for randomly drawing non-matching pairs.</span>
<span class="sd">                    "batched" should be the right choice in most scenarios.</span>
<span class="sd">                    "greedy" can be better if your pool of neurons is very</span>
<span class="sd">                    small.</span>
<span class="sd">    seed :              int, optional</span>
<span class="sd">                        Non-matching pairs are drawn at random using this</span>
<span class="sd">                        seed, by default {DEFAULT_SEED}.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dotprops</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">"core.Dotprops"</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="s2">"core.Dotprops"</span><span class="p">]],</span>
        <span class="n">matching_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]],</span>
        <span class="n">nonmatching_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_alpha</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">draw_strat</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"batched"</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_SEED</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">match_fn</span> <span class="o">=</span> <span class="n">dist_dot_alpha</span> <span class="k">if</span> <span class="n">use_alpha</span> <span class="k">else</span> <span class="n">dist_dot</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">dotprops</span><span class="p">,</span>
            <span class="n">matching_lists</span><span class="p">,</span>
            <span class="n">match_fn</span><span class="p">,</span>
            <span class="n">nonmatching_list</span><span class="p">,</span>
            <span class="n">draw_strat</span><span class="o">=</span><span class="n">draw_strat</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ndim</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lookup2d</span><span class="p">:</span>
        <span class="p">(</span><span class="n">dig0</span><span class="p">,</span> <span class="n">dig1</span><span class="p">),</span> <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Lookup2d</span><span class="p">(</span><span class="n">dig0</span><span class="p">,</span> <span class="n">dig1</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.LookupNd" class="doc doc-heading"> <code>navis.nbl.smat.LookupNd</code> <a href="#navis.nbl.smat.LookupNd" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LookupNd</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LookupAxis</span><span class="p">],</span> <span class="n">cells</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"boundaries and cells have inconsistent bin counts"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="n">cells</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Lookup takes </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span><span class="si">}</span><span class="s2"> arguments but </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2"> were given"</span>
            <span class="p">)</span>

        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.LookupNdBuilder" class="doc doc-heading"> <code>navis.nbl.smat.LookupNdBuilder</code> <a href="#navis.nbl.smat.LookupNdBuilder" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Class for building an N-dimensional score lookup (for e.g. NBLAST).</p> <p>Once instantiated, the axes of the lookup table must be defined. Call <code>.with_digitizers()</code> to manually define them, or <code>.with_bin_counts()</code> to learn them from the matched-pair data.</p> <p>Then call <code>.build()</code> to build the lookup table.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>neurons</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        An indexable, consistently-ordered sequence of all
        objects (typically neurons) which will be used as the
        training set. Importantly: each object must have a
        `len()`!
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> dict or list of objects (e.g. Dotprops)</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>matching_sets</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        Lists of neurons, as indices into `neurons`, which
        should be considered matches:

            [[0, 1, 2, 4], [5, 6], [9, 10, 11]]
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>list of lists of index into `neurons`</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>match_fn</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        Function taking 2 arguments, both instances of type
        `neurons`, and returning a list of 1D
        `numpy.ndarray`s of floats. The length of the list
        must be the same as the length of `boundaries`.
        The length of the `array`s must be the same as the
        number of points in the first argument. This function
        returns values describing the quality of point matches
        from a query to a target neuron.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> Callable[[object, object], List[np.ndarray[float]]]</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>nonmatching</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        List of objects, as indices into `neurons`, which
        should be be considered NON-matches. If not given,
        all `neurons` will be used (on the assumption that
        matches are a small subset of possible pairs).
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> list of index into `neurons`</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>draw_strat</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        Strategy for randomly drawing non-matching pairs. Only
        relevant if `nonmatching` is not provided.
        "batched" should be the right choice in most scenarios.
        "greedy" can be better if your pool of neurons is very
        small.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> "batched" | "greedy"</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'batched'</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>seed</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>        Non-matching pairs are drawn at random using this seed,
        by default {DEFAULT_SEED}.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> int</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code><span title="navis.nbl.smat.DEFAULT_SEED">DEFAULT_SEED</span></code> </span> </p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LookupNdBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Class for building an N-dimensional score lookup (for e.g. NBLAST).</span>

<span class="sd">    Once instantiated, the axes of the lookup table must be defined.</span>
<span class="sd">    Call `.with_digitizers()` to manually define them, or</span>
<span class="sd">    `.with_bin_counts()` to learn them from the matched-pair data.</span>

<span class="sd">    Then call `.build()` to build the lookup table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    neurons :       dict or list of objects (e.g. Dotprops)</span>
<span class="sd">                    An indexable, consistently-ordered sequence of all</span>
<span class="sd">                    objects (typically neurons) which will be used as the</span>
<span class="sd">                    training set. Importantly: each object must have a</span>
<span class="sd">                    `len()`!</span>
<span class="sd">    matching_sets : list of lists of index into `neurons`</span>
<span class="sd">                    Lists of neurons, as indices into `neurons`, which</span>
<span class="sd">                    should be considered matches:</span>

<span class="sd">                        [[0, 1, 2, 4], [5, 6], [9, 10, 11]]</span>

<span class="sd">    match_fn :      Callable[[object, object], List[np.ndarray[float]]]</span>
<span class="sd">                    Function taking 2 arguments, both instances of type</span>
<span class="sd">                    `neurons`, and returning a list of 1D</span>
<span class="sd">                    `numpy.ndarray`s of floats. The length of the list</span>
<span class="sd">                    must be the same as the length of `boundaries`.</span>
<span class="sd">                    The length of the `array`s must be the same as the</span>
<span class="sd">                    number of points in the first argument. This function</span>
<span class="sd">                    returns values describing the quality of point matches</span>
<span class="sd">                    from a query to a target neuron.</span>
<span class="sd">    nonmatching :   list of index into `neurons`, optional</span>
<span class="sd">                    List of objects, as indices into `neurons`, which</span>
<span class="sd">                    should be be considered NON-matches. If not given,</span>
<span class="sd">                    all `neurons` will be used (on the assumption that</span>
<span class="sd">                    matches are a small subset of possible pairs).</span>
<span class="sd">    draw_strat :    "batched" | "greedy"</span>
<span class="sd">                    Strategy for randomly drawing non-matching pairs. Only</span>
<span class="sd">                    relevant if `nonmatching` is not provided.</span>
<span class="sd">                    "batched" should be the right choice in most scenarios.</span>
<span class="sd">                    "greedy" can be better if your pool of neurons is very</span>
<span class="sd">                    small.</span>
<span class="sd">    seed :          int, optional</span>
<span class="sd">                    Non-matching pairs are drawn at random using this seed,</span>
<span class="sd">                    by default {DEFAULT_SEED}.</span>

<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">neurons</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="n">matching_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]],</span>
        <span class="n">match_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
        <span class="n">nonmatching_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draw_strat</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"batched"</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_SEED</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">neurons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matching_lists</span> <span class="o">=</span> <span class="n">matching_lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span> <span class="o">=</span> <span class="n">nonmatching_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_fn</span> <span class="o">=</span> <span class="n">match_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_draw</span> <span class="o">=</span> <span class="n">draw_strat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Digitizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ndim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_keys</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">idx1</span><span class="p">,</span> <span class="n">idx2</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndim</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_digitizers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digitizers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Digitizer</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Specify the axes of the output lookup table directly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        digitizers : List[Digitizer]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self</span>
<span class="sd">            For chaining convenience.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">digitizers</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Match function returns </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> values "</span>
                <span class="sa">f</span><span class="s2">"but provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">digitizers</span><span class="p">)</span><span class="si">}</span><span class="s2"> digitizers"</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="o">=</span> <span class="n">digitizers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">with_bin_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_counts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">"quantile"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Specify the number of bins on each axis of the output lookup table.</span>

<span class="sd">        The bin boundaries will be determined by evenly partitioning the data</span>
<span class="sd">        from the matched pairs into quantiles, in each dimension.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bin_counts : List[int]</span>
<span class="sd">        method :     'quantile' | 'geometric' | 'linear'</span>
<span class="sd">                     Method used to tile the data space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self</span>
<span class="sd">            For chaining convenience.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_counts</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Match function returns </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> values "</span>
                <span class="sa">f</span><span class="s2">"but provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_counts</span><span class="p">)</span><span class="si">}</span><span class="s2"> bin counts"</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span> <span class="o">=</span> <span class="n">bin_counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_object_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get all indices into objects instance member."""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nonmatching</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Indices of nonmatching set of neurons."""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_object_keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_yield_matching_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="n">NeuronKey</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Yield all index pairs within all matching pairs."""</span>
        <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_lists</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">yield_not_same</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_yield_nonmatching_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="n">NeuronKey</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Yield all index pairs within all non-matching pairs."""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Must provide non-matching pairs explicitly."</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">yield_not_same</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_yield_nonmatching_pairs_greedy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="n">NeuronKey</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Yield all index pairs within nonmatching list."""</span>
        <span class="k">return</span> <span class="n">yield_not_same</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatching</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_yield_nonmatching_pairs_batched</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">,</span> <span class="n">NeuronKey</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Yield all index pairs within nonmatching list.</span>

<span class="sd">        This function tries to generate truely random draws of all possible</span>
<span class="sd">        non-matching pairs without actually having to generate all pairs.</span>
<span class="sd">        Instead, we generate new randomly permutated pairs in batches from which</span>
<span class="sd">        we then remove previously seen pairs.</span>

<span class="sd">        This works reasonable well as long as we only need a small subset</span>
<span class="sd">        of all possible non-matches. Otherwise this becomes inefficient.</span>

<span class="sd">        """</span>
        <span class="n">nonmatching</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatching</span><span class="p">)</span>

        <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># Generate random pairs</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">nonmatching</span><span class="p">),</span> <span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">nonmatching</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="n">pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>  <span class="c1"># drop self hits</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span>  <span class="c1"># track already seen pairs</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># If exhausted, generate a new batch of random permutation</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">):</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">nonmatching</span><span class="p">),</span> <span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">nonmatching</span><span class="p">))</span>
                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="n">pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>  <span class="c1"># drop self hits</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">])</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span> <span class="o">-</span> <span class="n">seen</span>
                <span class="n">seen</span> <span class="o">=</span> <span class="n">seen</span> <span class="o">|</span> <span class="n">pairs</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Pick a pair</span>
            <span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">yield</span> <span class="p">(</span><span class="n">ix1</span><span class="p">,</span> <span class="n">ix2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_empty_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Create an empty array in which to store counts; shape determined by digitizer sizes."""</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the results of applying the match function to objects specified by indices."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">q_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">t_idx</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_query_many</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_pairs</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Yield results from querying many pairs of neuron indices."""</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">threads</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cpu_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span> <span class="ow">in</span> <span class="n">idx_pairs</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">threads</span> <span class="o">=</span> <span class="n">threads</span> <span class="ow">or</span> <span class="n">cpu_count</span>
        <span class="n">idx_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idx_pairs</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunksize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_pairs</span><span class="p">),</span> <span class="n">threads</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">exe</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">exe</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">match_fn</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx_pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx_pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span>
                <span class="n">chunksize</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_query_to_idxs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Produce a digitized counts array from a given query-target pair."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span><span class="p">),</span> <span class="n">counts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_count_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">counts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Convert raw match function ouput into a digitized counts array.</span>

<span class="sd">        Requires digitizers.</span>
<span class="sd">        """</span>
        <span class="c1"># Digitize</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dig</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">dig</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="p">,</span> <span class="n">results</span><span class="p">)]</span>

        <span class="c1"># Make a stack</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Create empty matrix if necessary</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_counts</span><span class="p">()</span>

        <span class="c1"># Get counts per cell -&gt; this is the actual bottleneck of this function</span>
        <span class="n">cells</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Fill matrix</span>
        <span class="n">counts</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">cells</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cells</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="o">+=</span> <span class="n">cnt</span>

        <span class="k">return</span> <span class="n">counts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_counts_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">idx_pairs</span><span class="p">,</span>
        <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Convert index pairs into a digitized counts array.</span>

<span class="sd">        Requires digitizers.</span>
<span class="sd">        """</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_counts</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">threads</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cpu_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
                <span class="n">idx_pairs</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span>
            <span class="p">):</span>
                <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_to_idxs</span><span class="p">(</span><span class="n">q_idx</span><span class="p">,</span> <span class="n">t_idx</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">counts</span>

        <span class="n">threads</span> <span class="o">=</span> <span class="n">threads</span> <span class="ow">or</span> <span class="n">cpu_count</span>
        <span class="n">idx_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idx_pairs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">chunksize</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_pairs</span><span class="p">),</span> <span class="n">threads</span><span class="p">)</span>

        <span class="c1"># because digitizing is not necessarily free,</span>
        <span class="c1"># keep this parallelisation separate to that in _query_many</span>
        <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span> <span class="k">as</span> <span class="n">exe</span><span class="p">:</span>
            <span class="c1"># This is the progress bar</span>
            <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_pairs</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">distdots</span> <span class="ow">in</span> <span class="n">exe</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">match_fn</span><span class="p">,</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx_pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">idx_pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span>
                    <span class="n">chunksize</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_results</span><span class="p">(</span><span class="n">distdots</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">counts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pick_nonmatching_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_matching_qual_vals</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Using the seeded RNG, pick which non-matching pairs to use."""</span>
        <span class="c1"># pre-calculating which pairs we're going to use,</span>
        <span class="c1"># rather than drawing them as we need them,</span>
        <span class="c1"># means that we can parallelise the later step more effectively.</span>
        <span class="c1"># Slowdowns here are practically meaningless</span>
        <span class="c1"># because of how long distdot calculation will take</span>
        <span class="n">nonmatching_pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_nonmatching_qual_vals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_draw</span> <span class="o">==</span> <span class="s2">"batched"</span><span class="p">:</span>
            <span class="c1"># This is a generator that tries to generate random pairs in</span>
            <span class="c1"># batches to avoid having to calculate all possible pairs</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yield_nonmatching_pairs_batched</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">"Drawing non-matching pairs"</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="n">n_matching_qual_vals</span><span class="p">,</span>
                <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="c1"># Draw non-matching pairs until we have enough data</span>
                <span class="k">for</span> <span class="n">nonmatching_pair</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
                    <span class="n">nonmatching_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nonmatching_pair</span><span class="p">)</span>
                    <span class="n">new_vals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">nonmatching_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">n_nonmatching_qual_vals</span> <span class="o">+=</span> <span class="n">new_vals</span>

                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_vals</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">n_nonmatching_qual_vals</span> <span class="o">&gt;=</span> <span class="n">n_matching_qual_vals</span><span class="p">:</span>
                        <span class="k">break</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_draw</span> <span class="o">==</span> <span class="s2">"greedy"</span><span class="p">:</span>
            <span class="c1"># Generate all possible non-matching pairs</span>
            <span class="n">possible_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatching</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatching</span><span class="p">)</span>
            <span class="n">all_nonmatching_pairs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">p</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_yield_nonmatching_pairs_greedy</span><span class="p">(),</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">possible_pairs</span><span class="p">,</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">"Generating non-matching pairs"</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># Randomly pick non-matching pairs until we have enough data</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">"Drawing non-matching pairs"</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="n">n_matching_qual_vals</span><span class="p">,</span>
                <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">n_nonmatching_qual_vals</span> <span class="o">&lt;</span> <span class="n">n_matching_qual_vals</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_nonmatching_pairs</span><span class="p">))</span>
                    <span class="n">nonmatching_pair</span> <span class="o">=</span> <span class="n">all_nonmatching_pairs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="n">nonmatching_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nonmatching_pair</span><span class="p">)</span>

                    <span class="n">new_vals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">nonmatching_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">n_nonmatching_qual_vals</span> <span class="o">+=</span> <span class="n">new_vals</span>

                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_vals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Unknown strategy for non-matching pair draw:"</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_draw</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">nonmatching_pairs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">matching_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yield_matching_pairs</span><span class="p">()))</span>

        <span class="c1"># If no explicit non-matches provided, pick them from the entire pool</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonmatching_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># need to know the eventual distdot count</span>
            <span class="c1"># so we know how many non-matching pairs to draw</span>
            <span class="n">q_idx_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">matching_pairs</span><span class="p">)</span>
            <span class="n">n_matching_qual_vals</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">q_idx</span><span class="p">])</span> <span class="o">*</span> <span class="n">n_reps</span>
                <span class="k">for</span> <span class="n">q_idx</span><span class="p">,</span> <span class="n">n_reps</span> <span class="ow">in</span> <span class="n">q_idx_count</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">nonmatching_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pick_nonmatching_pairs</span><span class="p">(</span><span class="n">n_matching_qual_vals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nonmatching_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yield_nonmatching_pairs</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">matching_pairs</span><span class="p">,</span> <span class="n">nonmatching_pairs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threads</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Digitizer</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="c1"># Asking for more threads than available CPUs seems to crash on Github</span>
        <span class="c1"># actions</span>
        <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="n">threads</span> <span class="o">&gt;=</span> <span class="n">cpu_count</span><span class="p">:</span>
            <span class="n">threads</span> <span class="o">=</span> <span class="n">cpu_count</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Builder needs either digitizers or bin_counts - "</span> <span class="s2">"see with_* methods."</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">matching_pairs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pairs</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Comparing matching pairs"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_counts_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts_array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matching_pairs</span><span class="p">,</span>
                <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
                <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">"Comparing matching pairs"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match_results</span> <span class="o">=</span> <span class="n">concat_results</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_query_many</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matching_pairs</span><span class="p">,</span> <span class="n">threads</span><span class="p">),</span>
                <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">"Comparing matching pairs"</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matching_pairs</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_results_</span> <span class="o">=</span> <span class="n">match_results</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nbins</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">match_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nbins</span><span class="p">,</span> <span class="n">Digitizer</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Digitizer</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_method</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error creating digitizers for axes </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Counting results (this may take a while)"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_counts_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_results</span><span class="p">(</span><span class="n">match_results</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Comparing non-matching pairs"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonmatch_counts_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counts_array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nonmatching_pairs</span><span class="p">,</span>
            <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">"Comparing non-matching pairs"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Account for there being different total numbers of datapoints for</span>
        <span class="c1"># matches and nonmatches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matching_factor_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonmatch_counts_</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_counts_</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match_counts_</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonmatch_counts_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Some lookup cells have no data in them"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cells_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match_counts_</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_factor_</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonmatch_counts_</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LookupNd</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Build the score matrix.</span>

<span class="sd">        All non-identical neuron pairs within all matching sets are selected,</span>
<span class="sd">        and the scoring function is evaluated for those pairs.</span>
<span class="sd">        Then, the minimum number of non-matching pairs are randomly drawn</span>
<span class="sd">        so that at least as many data points can be calculated for non-matching</span>
<span class="sd">        pairs.</span>

<span class="sd">        In each bin of the score matrix, the log2 odds ratio of a score</span>
<span class="sd">        in that bin belonging to a match vs. non-match is calculated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threads :   int, optional</span>
<span class="sd">                    If None, act in serial.</span>
<span class="sd">                    If 0, use cpu_count - 1.</span>
<span class="sd">                    Otherwise, use the given value.</span>
<span class="sd">                    Will be clipped at number of available cores - 1.</span>
<span class="sd">                    Note that with the currently implementation a large number</span>
<span class="sd">                    of threads might (and somewhat counterintuitively) actually</span>
<span class="sd">                    be slower than running building the scoring function in serial.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        LookupNd</span>
<span class="sd">        """</span>
        <span class="n">dig</span><span class="p">,</span> <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LookupNd</span><span class="p">(</span><span class="n">dig</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id="navis.nbl.smat.LookupNdBuilder.nonmatching" class="doc doc-heading"> <code class="highlight language-python"><span class="n">nonmatching</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">NeuronKey</span><span class="p">]</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href="#navis.nbl.smat.LookupNdBuilder.nonmatching" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Indices of nonmatching set of neurons.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.LookupNdBuilder.build" class="doc doc-heading"> <code class="highlight language-python"><span class="n">build</span></code> <a href="#navis.nbl.smat.LookupNdBuilder.build" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Build the score matrix.</p> <p>All non-identical neuron pairs within all matching sets are selected, and the scoring function is evaluated for those pairs. Then, the minimum number of non-matching pairs are randomly drawn so that at least as many data points can be calculated for non-matching pairs.</p> <p>In each bin of the score matrix, the log2 odds ratio of a score in that bin belonging to a match vs. non-match is calculated.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>threads</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>    If None, act in serial.
    If 0, use cpu_count - 1.
    Otherwise, use the given value.
    Will be clipped at number of available cores - 1.
    Note that with the currently implementation a large number
    of threads might (and somewhat counterintuitively) actually
    be slower than running building the scoring function in serial.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> int</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>None</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><a class="autorefs autorefs-internal" title="navis.nbl.smat.LookupNd" href="#navis.nbl.smat.LookupNd">LookupNd</a></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LookupNd</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the score matrix.</span>

<span class="sd">    All non-identical neuron pairs within all matching sets are selected,</span>
<span class="sd">    and the scoring function is evaluated for those pairs.</span>
<span class="sd">    Then, the minimum number of non-matching pairs are randomly drawn</span>
<span class="sd">    so that at least as many data points can be calculated for non-matching</span>
<span class="sd">    pairs.</span>

<span class="sd">    In each bin of the score matrix, the log2 odds ratio of a score</span>
<span class="sd">    in that bin belonging to a match vs. non-match is calculated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    threads :   int, optional</span>
<span class="sd">                If None, act in serial.</span>
<span class="sd">                If 0, use cpu_count - 1.</span>
<span class="sd">                Otherwise, use the given value.</span>
<span class="sd">                Will be clipped at number of available cores - 1.</span>
<span class="sd">                Note that with the currently implementation a large number</span>
<span class="sd">                of threads might (and somewhat counterintuitively) actually</span>
<span class="sd">                be slower than running building the scoring function in serial.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    LookupNd</span>
<span class="sd">    """</span>
    <span class="n">dig</span><span class="p">,</span> <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">LookupNd</span><span class="p">(</span><span class="n">dig</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.LookupNdBuilder.with_bin_counts" class="doc doc-heading"> <code class="highlight language-python"><span class="n">with_bin_counts</span></code> <a href="#navis.nbl.smat.LookupNdBuilder.with_bin_counts" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Specify the number of bins on each axis of the output lookup table.</p> <p>The bin boundaries will be determined by evenly partitioning the data from the matched pairs into quantiles, in each dimension.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>bin_counts</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>method</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <div class="highlight"><pre><span></span><code>     Method used to tile the data space.
</code></pre></div> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code> 'quantile' | 'geometric' | 'linear'</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>'quantile'</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="self">self</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>For chaining convenience.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_bin_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_counts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">"quantile"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Specify the number of bins on each axis of the output lookup table.</span>

<span class="sd">    The bin boundaries will be determined by evenly partitioning the data</span>
<span class="sd">    from the matched pairs into quantiles, in each dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bin_counts : List[int]</span>
<span class="sd">    method :     'quantile' | 'geometric' | 'linear'</span>
<span class="sd">                 Method used to tile the data space.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self</span>
<span class="sd">        For chaining convenience.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_counts</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Match function returns </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> values "</span>
            <span class="sa">f</span><span class="s2">"but provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_counts</span><span class="p">)</span><span class="si">}</span><span class="s2"> bin counts"</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span> <span class="o">=</span> <span class="n">bin_counts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bin_method</span> <span class="o">=</span> <span class="n">method</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id="navis.nbl.smat.LookupNdBuilder.with_digitizers" class="doc doc-heading"> <code class="highlight language-python"><span class="n">with_digitizers</span></code> <a href="#navis.nbl.smat.LookupNdBuilder.with_digitizers" class="headerlink" title="Permanent link">#</a></h3> <div class="doc doc-contents "> <p>Specify the axes of the output lookup table directly.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>digitizers</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-internal" title="navis.nbl.smat.Digitizer" href="#navis.nbl.smat.Digitizer">Digitizer</a>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RETURNS</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-returns-annotation"> <code><span title="self">self</span></code> </span> </td> <td class="doc-returns-details"> <div class="doc-md-description"> <p>For chaining convenience.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_digitizers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digitizers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Digitizer</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Specify the axes of the output lookup table directly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    digitizers : List[Digitizer]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self</span>
<span class="sd">        For chaining convenience.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">digitizers</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Match function returns </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> values "</span>
            <span class="sa">f</span><span class="s2">"but provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">digitizers</span><span class="p">)</span><span class="si">}</span><span class="s2"> digitizers"</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">digitizers</span> <span class="o">=</span> <span class="n">digitizers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bin_counts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id="navis.nbl.smat.SimpleLookup" class="doc doc-heading"> <code>navis.nbl.smat.SimpleLookup</code> <a href="#navis.nbl.smat.SimpleLookup" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Look up in a list of items and return their index.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>items</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>The item's position in the list is the index which will be returned.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Hashable" href="https://docs.python.org/3/library/typing.html#typing.Hashable">Hashable</a>]</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RAISES</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-raises-annotation"> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code> </span> </td> <td class="doc-raises-details"> <div class="doc-md-description"> <p>items are non-unique.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SimpleLookup</span><span class="p">(</span><span class="n">LookupAxis</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Look up in a list of items and return their index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    items : List[Hashable]</span>
<span class="sd">        The item's position in the list is the index which will be returned.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        items are non-unique.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">)}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Items are not unique"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.check_score_fn" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">check_score_fn</span></code> <a href="#navis.nbl.smat.check_score_fn" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Checks functionally that the callable can be used as a score function.</p> <table> <thead> <tr> <th><span class="doc-section-title">PARAMETER</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>nargs</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>How many positional arguments the score function should have.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>optional int</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>2</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>scalar</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Check that the function can be used on <code>nargs</code> scalars.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>optional bool</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> <tr class="doc-section-item"> <td> <code>array</code> </td> <td class="doc-param-details"> <div class="doc-md-description"> <p>Check that the function can be used on <code>nargs</code> 1D <code>numpy.ndarray</code>s.</p> </div> <p> <span class="doc-param-annotation"> <b>TYPE:</b> <code>optional bool</code> </span> <span class="doc-param-default"> <b>DEFAULT:</b> <code>True</code> </span> </p> </td> </tr> </tbody> </table> <table> <thead> <tr> <th><span class="doc-section-title">RAISES</span></th> <th><span>DESCRIPTION</span></th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <span class="doc-raises-annotation"> <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code> </span> </td> <td class="doc-raises-details"> <div class="doc-md-description"> <p>If the score function is not appropriate.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_score_fn</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scalar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Checks functionally that the callable can be used as a score function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nargs : optional int, default 2</span>
<span class="sd">        How many positional arguments the score function should have.</span>
<span class="sd">    scalar : optional bool, default True</span>
<span class="sd">        Check that the function can be used on `nargs` scalars.</span>
<span class="sd">    array : optional bool, default True</span>
<span class="sd">        Check that the function can be used on `nargs` 1D `numpy.ndarray`s.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the score function is not appropriate.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="n">nargs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">scalars</span><span class="p">),</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"smat does not take 2 floats and return a float"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
        <span class="n">test_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_arr</span><span class="p">]</span> <span class="o">*</span> <span class="n">nargs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">arrs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to use smat with numpy arrays: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">test_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"smat produced inconsistent shape: input </span><span class="si">{</span><span class="n">test_arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">; output </span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.chunksize" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">chunksize</span></code> <a href="#navis.nbl.smat.chunksize" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunksize</span><span class="p">(</span><span class="n">it_len</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">min_chunk</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_chunk</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">it_len</span> <span class="o">/</span> <span class="p">(</span><span class="n">cpu_count</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)))</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.concat_results" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">concat_results</span></code> <a href="#navis.nbl.smat.concat_results" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <p>Helper function to concatenate batches of e.g. [(dist, dots), (dist, dots)] into single (dist, dot) arrays.</p> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">concat_results</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
    <span class="n">total</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"Querying"</span><span class="p">,</span>
    <span class="n">progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Helper function to concatenate batches of e.g. [(dist, dots), (dist, dots)]</span>
<span class="sd">    into single (dist, dot) arrays.</span>
<span class="sd">    """</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">result_lst</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result_lst</span><span class="p">):</span>
                <span class="n">intermediate</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span> <span class="k">for</span> <span class="n">arrs</span> <span class="ow">in</span> <span class="n">intermediate</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.dist_dot" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">dist_dot</span></code> <a href="#navis.nbl.smat.dist_dot" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dist_dot</span><span class="p">(</span><span class="n">q</span><span class="p">:</span> <span class="s2">"core.Dotprops"</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="s2">"core.Dotprops"</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">dist_dots</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.dist_dot_alpha" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">dist_dot_alpha</span></code> <a href="#navis.nbl.smat.dist_dot_alpha" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dist_dot_alpha</span><span class="p">(</span><span class="n">q</span><span class="p">:</span> <span class="s2">"core.Dotprops"</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="s2">"core.Dotprops"</span><span class="p">):</span>
    <span class="n">dist</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">dist_dots</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dist</span><span class="p">,</span> <span class="n">dot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alpha</span><span class="p">)]</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.is_monotonically_increasing" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">is_monotonically_increasing</span></code> <a href="#navis.nbl.smat.is_monotonically_increasing" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_monotonically_increasing</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">prev_idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">&lt;=</span> <span class="n">lst</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.parse_boundary" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">parse_boundary</span></code> <a href="#navis.nbl.smat.parse_boundary" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_boundary</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">explicit_interval</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">explicit_interval</span> <span class="o">==</span> <span class="s2">"[)"</span><span class="p">:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">explicit_interval</span> <span class="o">==</span> <span class="s2">"(]"</span><span class="p">:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Enclosing characters '</span><span class="si">{</span><span class="n">explicit_interval</span><span class="si">}</span><span class="s2">' do not match a half-open interval"</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)),</span> <span class="n">right</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.parse_score_fn" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">parse_score_fn</span></code> <a href="#navis.nbl.smat.parse_score_fn" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_score_fn</span><span class="p">(</span><span class="n">smat</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">f</span><span class="s2">"""Interpret `smat` as a score function.</span>
<span class="s2">    Primarily for backwards compatibility.</span>
<span class="s2">    </span><span class="si">{</span><span class="n">SCORE_FN_DESCR</span><span class="si">}</span>
<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    smat : None | "auto" | str | os.PathLike | pandas.DataFrame | Callable[[float, float], float]</span>
<span class="s2">        If `None`, use `operator.mul`.</span>
<span class="s2">        If `"auto"`, use `navis.nbl.smat.smat_fcwb(alpha)`.</span>
<span class="s2">        If a dataframe, use `navis.nbl.smat.Lookup2d.from_dataframe(smat)`.</span>
<span class="s2">        If another string or path-like, load from CSV in a dataframe and uses as above.</span>
<span class="s2">        Also checks the signature of the callable.</span>
<span class="s2">        Raises an error, probably a ValueError, if it can't be interpreted.</span>
<span class="s2">    alpha : optional bool, default False</span>
<span class="s2">        If `smat` is `"auto"`, choose whether to use the FCWB matrices</span>
<span class="s2">        with or without alpha.</span>
<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    Callable</span>
<span class="s2">    Raises</span>
<span class="s2">    ------</span>
<span class="s2">    ValueError</span>
<span class="s2">        If score function cannot be interpreted.</span>
<span class="s2">    """</span>
    <span class="k">if</span> <span class="n">smat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">smat</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span>
    <span class="k">elif</span> <span class="n">smat</span> <span class="o">==</span> <span class="s2">"auto"</span><span class="p">:</span>
        <span class="n">smat</span> <span class="o">=</span> <span class="n">smat_fcwb</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smat</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
        <span class="n">smat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">smat</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smat</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">smat</span> <span class="o">=</span> <span class="n">Lookup2d</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">smat</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">smat</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"smat should be a callable, a path, a pandas.DataFrame, or 'auto'"</span>
        <span class="p">)</span>

    <span class="n">check_score_fn</span><span class="p">(</span><span class="n">smat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">smat</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id="navis.nbl.smat.yield_not_same" class="doc doc-heading"> <code class="highlight language-python"><span class="n">navis</span><span class="o">.</span><span class="n">nbl</span><span class="o">.</span><span class="n">smat</span><span class="o">.</span><span class="n">yield_not_same</span></code> <a href="#navis.nbl.smat.yield_not_same" class="headerlink" title="Permanent link">#</a></h2> <div class="doc doc-contents first"> <details class="quote"> <summary>Source code in <code>navis/nbl/smat.py</code></summary> <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">yield_not_same</span><span class="p">(</span><span class="n">pairs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</code></pre></div></td></tr></tbody></table></div> </details> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tabs.link", "content.code.annotate", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script> <script src="../../../../assets/_markdown_exec_pyodide.js"></script> <script src="../../../../javascripts/katex.js"></script> <script src="../../../../assets/external/unpkg.com/katex@0/dist/katex.min.js"></script> <script src="../../../../assets/external/unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script> <script src="../../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>  <script id="init-glightbox">document.querySelectorAll('.glightbox').forEach(function(element) {
    try {
        var img = element.querySelector('img');
        if (img && img.src) {
            element.setAttribute('href', img.src);
        } else {
            console.log('No img element with src attribute found');
        }
    } catch (error) {
        console.log('Error:', error);
    }
});
const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>